{
  "kind": "build_request",
  "title": "Add disaster crash tracking system with multiple aircraft support and severity warning filter",
  "projectName": "Aviation Crash Archive",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-20",
      "text": "Add a Boolean field 'isDisasterCrash' to the CrashRecord type in backend/main.mo to track whether multiple aircraft were involved in the crash incident",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-disaster-crashes"
        ],
        "quotes": [
          "Add a system if the crash had multiple planes or not"
        ]
      },
      "acceptanceCriteria": [
        "CrashRecord type includes isDisasterCrash: Bool field",
        "Field defaults to false for existing crash records"
      ]
    },
    {
      "id": "REQ-21",
      "text": "Add an array field 'involvedAircraft' to the CrashRecord type in backend/main.mo to store details about each aircraft involved in disaster crashes, with each entry containing aircraft type, registration number, airline, and casualties for that specific aircraft",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-disaster-crashes"
        ],
        "quotes": [
          "if it did you can create it as an option"
        ]
      },
      "acceptanceCriteria": [
        "CrashRecord type includes involvedAircraft: [AircraftInvolvement] field",
        "AircraftInvolvement type includes aircraftType, registration, airline, casualties fields",
        "Field is an empty array for single-aircraft crashes"
      ]
    },
    {
      "id": "REQ-22",
      "text": "Update the addCrashRecord function in backend/main.mo to validate that multiple aircraft can only be added when sourceVerification is true, rejecting the submission with an error message if sourceVerification is false and isDisasterCrash is true",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-assistant-clarification-response"
        ],
        "quotes": [
          "Add multiple aircraft only if the source is verified"
        ]
      },
      "acceptanceCriteria": [
        "Function rejects disaster crash submissions when sourceVerification is false",
        "Error message clearly states 'Multiple aircraft can only be added for verified sources'",
        "Single aircraft crashes are accepted regardless of sourceVerification status"
      ]
    },
    {
      "id": "REQ-23",
      "text": "Update the getCrashRecords query in backend/main.mo to accept an optional 'includeDisasterCrashes' Boolean parameter that filters out disaster crashes when set to false, defaulting to false",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-assistant-final-confirmation"
        ],
        "quotes": [
          "Add a 'Show Disaster Crashes' toggle filter similar to the fantasy crashes filter"
        ]
      },
      "acceptanceCriteria": [
        "getCrashRecords accepts includeDisasterCrashes parameter",
        "When includeDisasterCrashes is false, crashes with isDisasterCrash=true are filtered out",
        "Parameter defaults to false when not provided",
        "Filter works independently from includeFantasy parameter"
      ]
    },
    {
      "id": "REQ-24",
      "text": "Update the CrashRecordForm component in frontend/src/components/CrashRecordForm.tsx to add a checkbox labeled 'Multiple Aircraft Involved (Disaster Crash)' that is only enabled when source verification is true, and when checked, displays additional input fields for adding multiple aircraft details",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-clarification-response"
        ],
        "quotes": [
          "Only allow adding multiple aircraft to a crash if the source is verified"
        ]
      },
      "acceptanceCriteria": [
        "Checkbox is disabled with tooltip message when sourceVerification field is empty or false",
        "Checkbox enables when sourceVerification field indicates verified source",
        "When checked, form displays repeatable aircraft entry fields (type, registration, airline, casualties)",
        "Users can add/remove aircraft entries dynamically",
        "Form validates at least 2 aircraft are entered when disaster crash is checked"
      ]
    },
    {
      "id": "REQ-25",
      "text": "Add a 'Show Disaster Crashes' toggle checkbox filter to the DashboardPage component in frontend/src/pages/DashboardPage.tsx that filters the crash list to show or hide disaster crashes based on user preference, defaulting to hidden",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-final-confirmation"
        ],
        "quotes": [
          "Add a 'Show Disaster Crashes' toggle filter in the dashboard (similar to fantasy crashes filter)"
        ]
      },
      "acceptanceCriteria": [
        "Toggle checkbox labeled 'Show Disaster Crashes' added to filter controls",
        "Filter defaults to unchecked (disaster crashes hidden)",
        "Toggling the filter updates the crash list immediately",
        "Filter state persists during the session"
      ]
    },
    {
      "id": "REQ-26",
      "text": "Display a prominent severity warning modal or alert in the DashboardPage component when users enable the 'Show Disaster Crashes' filter for the first time, warning about graphic/severe content and requiring user acknowledgment before showing disaster crashes",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-final-confirmation"
        ],
        "quotes": [
          "Display a prominent severity warning when users enable this filter",
          "Warning message will inform users about the graphic/severe nature of these crashes and require acknowledgment"
        ]
      },
      "acceptanceCriteria": [
        "Modal or alert appears when user first checks the disaster crashes filter",
        "Warning message clearly states the content may be graphic or disturbing",
        "User must acknowledge with 'I Understand' button before filter takes effect",
        "If user cancels, the filter remains unchecked",
        "Acknowledgment is remembered for the session (warning only shows once per session)"
      ]
    },
    {
      "id": "REQ-27",
      "text": "Update the useCrashRecords hook in frontend/src/hooks/useQueries.ts to accept an 'includeDisasterCrashes' parameter and pass it to the backend getCrashRecords query",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-final-confirmation"
        ],
        "quotes": [
          "Add a 'Show Disaster Crashes' toggle filter similar to the fantasy crashes filter"
        ]
      },
      "acceptanceCriteria": [
        "useCrashRecords hook accepts includeDisasterCrashes Boolean parameter",
        "Parameter is passed to backend getCrashRecords query",
        "Hook updates queries when includeDisasterCrashes parameter changes"
      ]
    },
    {
      "id": "REQ-28",
      "text": "Update the CrashListItem component in frontend/src/components/CrashListItem.tsx to display a 'Disaster Crash' badge with warning styling when isDisasterCrash is true, showing the number of aircraft involved",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-final-confirmation"
        ],
        "quotes": [
          "Disaster crashes (multiple aircraft involved)"
        ]
      },
      "acceptanceCriteria": [
        "Badge displays 'Disaster Crash' text with warning icon",
        "Badge uses distinct warning color (e.g., orange or red accent)",
        "Badge shows aircraft count (e.g., '3 Aircraft Involved')",
        "Badge appears alongside existing verification status badges"
      ]
    },
    {
      "id": "REQ-29",
      "text": "Update the CrashDetailsPanel component in frontend/src/components/CrashDetailsPanel.tsx to display disaster crash information including a list of all involved aircraft with their details (type, registration, airline, casualties) when isDisasterCrash is true",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-disaster-crashes"
        ],
        "quotes": [
          "if the crash had multiple planes or not"
        ]
      },
      "acceptanceCriteria": [
        "Panel shows 'Multiple Aircraft Involved' section when isDisasterCrash is true",
        "Each involved aircraft is listed with type, registration, airline, and casualties",
        "Total casualties across all aircraft are calculated and displayed",
        "Section is not shown for single-aircraft crashes"
      ]
    }
  ],
  "constraints": [
    "Multiple aircraft entries can only be added when sourceVerification is true",
    "Disaster crashes must be filtered out by default (includeDisasterCrashes defaults to false)",
    "The isDisasterCrash field and involvedAircraft array must be added to the existing CrashRecord type without breaking existing data"
  ],
  "nonGoals": [
    "Automatic detection of disaster crashes from external data sources",
    "Historical migration of existing crashes to mark known disaster crashes",
    "Cross-referencing involved aircraft registrations between disaster crashes",
    "Creating a separate disaster crash category distinct from verified/unverified/fantasy statuses"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}